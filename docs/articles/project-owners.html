<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Project Owners • zoltr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Project Owners">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">zoltr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting-started.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/project-owners.html">Project Owners</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/reichlab/zoltr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Project Owners</h1>
                        <h4 class="author">Matthew Cornell</h4>
            
            <h4 class="date">2020-04-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/reichlab/zoltr/blob/master/vignettes/project-owners.Rmd"><code>vignettes/project-owners.Rmd</code></a></small>
      <div class="hidden name"><code>project-owners.Rmd</code></div>

    </div>

    
    
<div id="zoltr-for-project-owners" class="section level1">
<h1 class="hasAnchor">
<a href="#zoltr-for-project-owners" class="anchor"></a>zoltr for Project Owners</h1>
<p>Welcome to the zoltr vignette for project owners and forecasters. You should read this if you are interested in creating and managing your own <a href="https://www.zoltardata.com/">zoltardata.com</a> projects using this package to access them via the Zoltar API. Building on the <em>Getting Started</em> vignette, this one covers creating projects and models, and uploading forecasts.</p>
<p>Before starting you should have an account on <a href="https://www.zoltardata.com/">zoltardata.com</a>, and an <a href="https://csgillespie.github.io/efficientR/3-3-r-startup.html#renviron"><code>.Renviron</code></a> file set up as described in <em>Getting Started</em>.</p>
<div id="connect-to-the-host-and-authenticate" class="section level2">
<h2 class="hasAnchor">
<a href="#connect-to-the-host-and-authenticate" class="anchor"></a>Connect to the host and authenticate</h2>
<!-- run but don't show. NB: will run only if above eval=TRUE -->
<!-- run but don't show. NB: will run only if above eval=TRUE -->
<!-- show but don't run-->
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(zoltr)
zoltar_connection &lt;-<span class="st"> </span><span class="kw"><a href="../reference/new_connection.html">new_connection</a></span>()
<span class="kw"><a href="../reference/zoltar_authenticate.html">zoltar_authenticate</a></span>(zoltar_connection, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.getenv">Sys.getenv</a></span>(<span class="st">"Z_USERNAME"</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.getenv">Sys.getenv</a></span>(<span class="st">"Z_PASSWORD"</span>))</code></pre></div>
</div>
<div id="create-a-sandbox-project-to-play-with" class="section level2">
<h2 class="hasAnchor">
<a href="#create-a-sandbox-project-to-play-with" class="anchor"></a>Create a sandbox project to play with</h2>
<p>Let’s use the <code><a href="../reference/create_project.html">create_project()</a></code> function to make a temporary project to work with. (Note that if you’re repeating this step and need to delete a previously-created project, you can either use the web UI’s delete button on the project detail page or call the zoltr <code><a href="../reference/delete_project.html">delete_project()</a></code> function to do it programmatically.) <code><a href="../reference/create_project.html">create_project()</a></code> takes a <code>project_config</code> parameter that is a <code>list</code> specifying everything Zoltar needs to create a project, including meta information like name, whether it’s public, etc. In addition it lists the units, targets, and timezeros to create. The new project’s URL is returned, which you can pass to other functions. Here we use <code>docs-project.json</code>, which is the one that creates the example documentation project.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">project_config &lt;-<span class="st"> </span>jsonlite<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/jsonlite/topics/read_json">read_json</a></span>(<span class="st">"docs-project.json"</span>)  <span class="co"># "name": "My project"</span>
project_url &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_project.html">create_project</a></span>(zoltar_connection, project_config)
the_project_info &lt;-<span class="st"> </span><span class="kw"><a href="../reference/project_info.html">project_info</a></span>(zoltar_connection, project_url)</code></pre></div>
</div>
<div id="add-a-model-to-the-project-and-then-upload-a-forecast-into-it" class="section level2">
<h2 class="hasAnchor">
<a href="#add-a-model-to-the-project-and-then-upload-a-forecast-into-it" class="anchor"></a>Add a model to the project and then upload a forecast into it</h2>
<p>We can use the <code><a href="../reference/create_model.html">create_model()</a></code> function to create a model in a particular project. Like <code><a href="../reference/create_project.html">create_project()</a></code>, it takes a <code>list</code> that is the configuration to use when creating the model. There is an example at <code>example-model-config.json</code>, but here we will construct the <code>list</code> ourselves.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model_config &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="st">"name"</span> =<span class="st"> "a model_name"</span>,
                     <span class="st">"abbreviation"</span> =<span class="st"> "an abbreviation"</span>,
                     <span class="st">"team_name"</span> =<span class="st"> "a team_name"</span>,
                     <span class="st">"description"</span> =<span class="st"> "a description"</span>,
                     <span class="st">"home_url"</span> =<span class="st"> "http://example.com/"</span>,
                     <span class="st">"aux_data_url"</span> =<span class="st"> "http://example.com/"</span>)
model_url &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_model.html">create_model</a></span>(zoltar_connection, project_url, model_config)</code></pre></div>
<p>Now let’s upload a forecast to the model using <code><a href="../reference/upload_forecast.html">upload_forecast()</a></code> and then see how to list all of a model’s forecasts (in this case just the one). Keep in mind that Zoltar enqueues long operations like forecast uploading, which keeps the site responsive but makes the Zoltar API a little more complicated. Rather than having the <code><a href="../reference/upload_forecast.html">upload_forecast()</a></code> function <em>block</em> until the upload is done, you instead get a quick response in the form of an <code>UploadFileJob</code> URL that you can pass to the <code><a href="../reference/upload_info.html">upload_info()</a></code> function to check its status and find out when the upload is pending, done, or failed). (This is called <em>polling</em> the host to ask the status.) Here we poll every second using a helper function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">busy_poll_upload_file_job &lt;-<span class="st"> </span><span class="cf">function</span>(zoltar_connection, upload_file_job_url) {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"polling for status change. upload_file_job: "</span>, upload_file_job_url, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>))
  <span class="cf">while</span> (<span class="ot">TRUE</span>) {
    status &lt;-<span class="st"> </span><span class="kw"><a href="../reference/upload_info.html">upload_info</a></span>(zoltar_connection, upload_file_job_url)<span class="op">$</span>status
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(status, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>))
    <span class="cf">if</span> (status <span class="op">==</span><span class="st"> "FAILED"</span>) {
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"x failed</span><span class="ch">\n</span><span class="st">"</span>))
      <span class="cf">break</span>
    }
    <span class="cf">if</span> (status <span class="op">==</span><span class="st"> "SUCCESS"</span>) {
      <span class="cf">break</span>
    }
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.sleep">Sys.sleep</a></span>(<span class="dv">1</span>)
  }
}</code></pre></div>
<p><code><a href="../reference/upload_forecast.html">upload_forecast()</a></code> takes the <code>model_url</code> to upload to, the <code>timezero_date</code> in the project to associate the forecast with, and the <code>forecast_data</code> itself. The latter is a nested <code>list</code> of <em>predictions</em> as documented in <a href="https://docs.zoltardata.com/">docs.zoltardata.com</a>, but you can learn about it by looking at the example <code>docs-predictions.json</code>. Briefly, you can see that there is a <code>predictions</code> list of <code>prediction elements</code> (the <code>meta</code> section is ignored), each of which encodes data for a particular unit and target combination. Each <code>prediction element</code> has a class that’s one of four possibilities: <code>bin</code>, <code>named</code>, <code>point</code>, and <code>sample</code>. The structure of the <code>prediction element's</code> contents (the <code>prediction</code> section) is determined by the particular class. For example, a <code>point</code> just has a <code>value</code>, but a <code>bin</code> has a table of <code>cat</code> and <code>prob</code> values.</p>
<p>Here we will upload the <code>docs-predictions.json</code> file. Note that the passed <code>timezero_date</code> matches one of the timezeros in <code>docs-project.json</code>, the file that was used to create the project. It is an error otherwise.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">forecast_data &lt;-<span class="st"> </span>jsonlite<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/jsonlite/topics/read_json">read_json</a></span>(<span class="st">"docs-predictions.json"</span>)
upload_file_job_url &lt;-<span class="st"> </span><span class="kw"><a href="../reference/upload_forecast.html">upload_forecast</a></span>(zoltar_connection, model_url, <span class="st">"2011-10-02"</span>, forecast_data)
<span class="kw">busy_poll_upload_file_job</span>(zoltar_connection, upload_file_job_url)
<span class="co">#&gt; polling for status change. upload_file_job: https://www.zoltardata.com/api/uploadfilejob/9689/</span>
<span class="co">#&gt; QUEUED</span>
<span class="co">#&gt; SUCCESS</span></code></pre></div>
<p>Hopefully you’ll see some number of “QUEUED” entries followed by a “SUCCESS” one. (How long it takes will depend on how much other work Zoltar is handling.)</p>
<p>Get the new forecast’s URL from the <code>UploadFileJob</code> object and then call the <code><a href="../reference/forecasts.html">forecasts()</a></code> function to get a <code>data.frame</code> of that model’s forecasts (just the one in our case).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">the_upload_info &lt;-<span class="st"> </span><span class="kw"><a href="../reference/upload_info.html">upload_info</a></span>(zoltar_connection, upload_file_job_url)
forecast_url &lt;-<span class="st"> </span><span class="kw"><a href="../reference/upload_info_forecast_url.html">upload_info_forecast_url</a></span>(zoltar_connection, the_upload_info)
the_forecast_info &lt;-<span class="st"> </span><span class="kw"><a href="../reference/forecast_info.html">forecast_info</a></span>(zoltar_connection, forecast_url)
the_forecasts &lt;-<span class="st"> </span><span class="kw"><a href="../reference/forecasts.html">forecasts</a></span>(zoltar_connection, the_forecast_info<span class="op">$</span>forecast_model)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(the_forecasts)
<span class="co">#&gt; 'data.frame':    1 obs. of  7 variables:</span>
<span class="co">#&gt;  $ id                : int 9729</span>
<span class="co">#&gt;  $ url               : chr "https://www.zoltardata.com/api/forecast/9729/"</span>
<span class="co">#&gt;  $ forecast_model_url: chr "https://www.zoltardata.com/api/model/113/"</span>
<span class="co">#&gt;  $ source            : chr "forecast839c2fb3f2b8.json"</span>
<span class="co">#&gt;  $ timezero_url      : chr "https://www.zoltardata.com/api/timezero/425/"</span>
<span class="co">#&gt;  $ created_at        : Date, format: "2020-04-07"</span>
<span class="co">#&gt;  $ forecast_data_url : chr "https://www.zoltardata.com/api/forecast/9729/data/"</span></code></pre></div>
</div>
<div id="clean-up-by-deleting-the-sandbox-project" class="section level2">
<h2 class="hasAnchor">
<a href="#clean-up-by-deleting-the-sandbox-project" class="anchor"></a>Clean up by deleting the sandbox project</h2>
<p><strong>NB: This will delete all of the data associated with the project without warning, including models and forecasts.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/delete_project.html">delete_project</a></span>(zoltar_connection, project_url)</code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#zoltr-for-project-owners">zoltr for Project Owners</a><ul class="nav nav-pills nav-stacked">
<li><a href="#connect-to-the-host-and-authenticate">Connect to the host and authenticate</a></li>
      <li><a href="#create-a-sandbox-project-to-play-with">Create a sandbox project to play with</a></li>
      <li><a href="#add-a-model-to-the-project-and-then-upload-a-forecast-into-it">Add a model to the project and then upload a forecast into it</a></li>
      <li><a href="#clean-up-by-deleting-the-sandbox-project">Clean up by deleting the sandbox project</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Matthew Cornell, Nicholas Reich.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
